<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hangman Games</title>
  <link rel="stylesheet" href="style.css">
  <script src="apicalls.js"></script>

  
</head>
<body>
  <h1>Hangman Games</h1>
     <div id="createGameContainer">
        <table id="gameList">
            <!-- The grid will be dynamically generated by JavaScript -->
        </table>
    </div>
    <br>
    <div id="pageNavigator"></div>

    <br>
    <div id="buttonContainer">
        <button id="joinGame">Join</button>
        <button id="createGame">Create</button>
    </div>

  <script>
    document.getElementById("joinGame").disabled = true;

    window.addEventListener('DOMContentLoaded', async () => {
      var games = [];
      const gamesPerPage = 10;
      var selectedGameName = null;

      function getStatusClass(game) {
        if (game.status === "ACTIVE") return "status-active";
        if (game.status === "WON") return "status-won";
        if (game.status === "LOST") return "status-lost";
        return "";
      }

      function getNumberOfPages(){
        const gamesPerPage = 10;
        return Math.ceil(games.length / gamesPerPage);
      }

      function displayGames(page) {
        const table = document.getElementById("gameList");

        table.innerHTML = ""; // Clear existing content

          if (!games || games.length === 0) {
            document.getElementById("container").innerText = "No games found.";
            return;
          }
 
        games = games.sort((a, b) => new Date(b.dateCre) - new Date(a.dateCre));
          
        const paginatedGames = games.slice((page - 1) * gamesPerPage, page * gamesPerPage);

        paginatedGames.forEach(game => {
          const row = document.createElement("tr");
          const statusClass = getStatusClass(game);
          // mark row clickable and store game name
          row.classList.add('clickable-row');
          if(statusClass){
          row.classList.add(statusClass);
          }
          row.dataset.gamename = game.name;
          row.addEventListener('click', () => {
            if(statusClass){
            row.classList.remove(statusClass)
            };
            // optional visual selection
            if(selectedGameName){
            const game = games.find(g => g.name === selectedGameName);
            const statusClass = getStatusClass(game);
            document.querySelectorAll('#gameList tr.selected').forEach(r => r.classList.add(statusClass));  
            } 
            document.querySelectorAll('#gameList tr.selected').forEach(r => r.classList.remove('selected'));   
            row.classList.add('selected');
            selectedGameName = row.dataset.gamename;
            document.getElementById("joinGame").disabled = false;
          });
          row.innerHTML = `
            <td>${game.name}</td><td>${new Date(game.dateCre).toLocaleString()}</td><td>${game.status}</td>
          `;
          table.appendChild(row);
        });
      }
 

      function displayPageNavigator(){
        let numberOfPages = getNumberOfPages();
        const pageNavigator = document.getElementById("pageNavigator");
        pageNavigator.innerHTML = ""; // Clear existing content

        for (let i = 1; i <= numberOfPages; i++) {
          const link = document.createElement("a");
          link.href = "#";
          link.innerText = i; 
          link.style.margin = "5px";
          link.style.padding = "5px 10px";
          link.style.cursor = "pointer";
          link.addEventListener("click", (e) => {
            e.preventDefault();
            displayGames(i);
            displayPageNavigator(); // Refresh page navigator
          });
          pageNavigator.appendChild(link);
        }
      }

      document.getElementById("createGame").addEventListener("click", () => {
        window.location.href = "createGame.html";
      });
      document.getElementById("joinGame").addEventListener("click", () => {
        if (!selectedGameName) {
          alert("Please select a game to join.");
          return;
        }
        window.location.href = `connectGame.html?name=${encodeURIComponent(selectedGameName)}`;
      });
      try {
        games = await fetchGames(); // await the promise so games is the actual array
      } catch (err) {
        console.error("Failed to load games:", err);
        document.getElementById("container").innerText = "Failed to load games.";
        return;
      }

      // initial render
      displayGames(1);
      displayPageNavigator();
       });
  </script>
</body>
</html>

