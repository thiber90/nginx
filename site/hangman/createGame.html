<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hangman Games</title>
  <link rel="stylesheet" href="style.css">
  <script src="apicalls.js" defer></script>
</head>
<body>
<h1>Create a new Hangman game</h1>
<br>
    <div id="createGameContainer">
  <form id="createGameForm">
    <label for="name">Name:</label>
    <input type="text" id="name" maxlength="25" name="name" required><br><br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" maxlength="25" required><br><br>

    <label for="word">Word to Find:</label>
    <input type="text" id="word" name="word" maxlength="25" pattern="[A-Z]+" required>
      </form>
    <br><br>
     <br>
   

  </div>
  <br>
  <p id="messageDisplay"></p>
    <br>
    <br>
   <div id="buttonContainer">
    <button type="button" id="createButton">Create</button>
    <button type="button" id="cancelButton">Cancel</button>
    </div>
  <br>

  <script>
    // Prevent numbers in word input, allow both uppercase and lowercase letters
    document.getElementById("word").addEventListener("input", function() {
      this.value = this.value.replace(/[^A-Za-z]/g, '').toUpperCase();
    });

    document.getElementById("createButton").addEventListener("click", async () => {
      const name = document.getElementById("name").value;
      const password = document.getElementById("password").value;
      const word = document.getElementById("word").value;
      if(name === "" || word === "" || password === ""){
          const missing = [];

        if (!name) missing.push("name");
        if (!password) missing.push("password");
        if (!word) missing.push("word");

        document.getElementById("messageDisplay").innerText = `Missing required fields: ${missing.join(", ")}`;
        return;

      }
      try {
        // Fetch the game by name
        const existingGame = await getGameByName(name);

        if (existingGame !== null) {
          document.getElementById("messageDisplay").innerText = `A game with the name "${name}" already exists.`;
          return;
        }

        // Create a new game
        const newGame = await createGame({
          name,
          password,
          word,
          status: "ACTIVE",
          dateCre: new Date().toISOString()
        });

        console.log("New game created:", newGame);
        window.location.href = "index.html"; // Redirect to index.html on success
      } catch (error) {
        // TODO show the error in a error bar
        alert("Failed to create game: " + error.message);
      }
    });

    document.getElementById("cancelButton").addEventListener("click", () => {
      window.location.href = "index.html"; // Redirect to index.html on cancel
    });
  </script>
  <div class="footer">
    Developed by Thibaut B. - thiber90@gmail.com
  </div>
</body>
</html>
